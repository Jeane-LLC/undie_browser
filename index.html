<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>dungeon.chat</title>
    <style>
      body { margin: 0;
	     width:100%;
	     height:100vh;
	     overflow:hidden;}
    </style>
  </head>
  <body>   
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0"/>
    <noscript> Whoops, dungeon.chat needs Javascript to work </noscript>
    <script src="index.js"></script>
    <script type="module">

      import * as THREE from 'https://unpkg.com/three@0.126.1/build/three.module.js';
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera( 75, window.innerWidth/ window.innerHeight, 0.1, 1000);
      const renderer = new THREE.WebGLRenderer();

      scene.background = new THREE.Color(0x444444);
      renderer.setSize( window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      const lights = [];
      lights[0] = new THREE.PointLight(0xffffff,1,0);
      lights[0].position.set(0,-10,5);

      scene.add(lights[0]);
      
      const pGeometry = new THREE.PlaneGeometry(10000,10000);
      const pMaterial = new THREE.MeshBasicMaterial( {color:0xffff00, side: THREE.DoubleSide});
      pMaterial.colorWrite = false;
      const plane = new THREE.Mesh( pGeometry, pMaterial);
      scene.add(plane);

      
      const sGeometry = new THREE.SphereGeometry(7,20,20);
      const sMaterial = new THREE.MeshBasicMaterial({
	  color:0x00ff00
      });

      const cGeometry = new THREE.SphereGeometry(9,6,6,0.0,Math.PI,0.0,Math.PI/2.0);
      const cMaterial = new THREE.MeshBasicMaterial({
	  color:0x00ff00
      });
      
      const sphere = new THREE.Mesh(sGeometry, sMaterial);
      const curve = new THREE.Mesh(cGeometry, cMaterial);
      sphere.add(curve);
      scene.add(sphere);
      camera.position.z = 75;

      const raycaster = new THREE.Raycaster();
      const mouse = new THREE.Vector2();

      window.addEventListener( 'click',
			       function(event){
				   mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
				   mouse.y = -(event.clientY / window.innerHeight) * 2 +1;
				   raycaster.setFromCamera( mouse, camera);
				   const p = raycaster.intersectObject(plane)[0].point;
				   sphere.position.set(p.x,p.y,0.0);
			       })

      window.addEventListener( 'resize',
			       function () {
				   camera.aspect = window.innerWidth / window.innerHeight;
				   camera.updateProjectionMatrix();
				   renderer.setSize( window.innerWidth, window.innerHeight );
			}, false );

      function animate(){
	  requestAnimationFrame(animate);
	  renderer.render( scene,camera);
      }

      animate();

    </script>
  
  </body>
</html>
